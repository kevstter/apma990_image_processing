\chapter{Active Contours Without Edges}
\label{ch:acwe}
The previous section we review the GAC model and outlined its shortcomings. Perhaps the key deficiency of that model is its sensitivity to initial condition and heavy reliance on user directed input to generate the desired result. It is also an edge-based model, and expects homogeneous regions to be separated by sharp transitions characterized by large gradients. This we saw led to poor performance on noisy images.

The active contours without edges (ACWE) model developed by Chan and Vese \cite{chan2001active} resolves this problem by proposing an energy based upon 2 fitting terms (for 2-phase segmentation). The energy they sought to minimize is 
\begin{align}
\eacwe(\C, c_1, c_2, \lambda)
= \textrm{ Length($\C$) } 
+ \lambda \int_{\Sigma} (c_1 - f )^2 \dx
+ \lambda \int_{\Omega \setminus \Sigma} (c_2 - f )^2 \dx.
\end{align}
The last two terms of $\eacwe$ are the fitting terms we were referring to and within them two key quantities, $c_1, c_2 \in \mathbf{R}$, are introduced. They are best understood with a simple piecewise constant image with 2 homogeneous regions, see Figure \ref{fig:fitting}. Suppose the gray levels of the image are 0 and 1, with 1 being maximum intensity. Then with the contour as in Figure \ref{fig:gull}, $c_1 = 1$ and $c_2 = 0$ would minimize the fitting terms as each integral will evaluate to zero. However, with any other contour, eg. \Cref{fig:tiger} or \Cref{fig:mouse}, one or both fitting terms will be positive regardless of how one chooses $c_1$ and $c_2$. Consequently, minimizing $\eacwe$ should drive the contour towards the ``best fit'' without relying on image gradients.

In the next sections we will derive an Euler-Lagrange equation to the ACWE model, provide a numerical discretization, and solve to steady state by gradient descent. Strengths and weaknesses of the model will be discussed.

\begin{figure}
	\centering
	\begin{subfigure}[b]{0.31\textwidth}
%		\includegraphics[width=\textwidth]{gull}
		\caption{A gull}
		\label{fig:gull}
	\end{subfigure}
	~ %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. 
	%(or a blank line to force the subfigure onto a new line)
	\begin{subfigure}[b]{0.31\textwidth}
%		\includegraphics[width=\textwidth]{tiger}
		\caption{A tiger}
		\label{fig:tiger}
	\end{subfigure}
	~ %add desired spacing between images, e. g. ~, \quad, \qquad, \hfill etc. 
	%(or a blank line to force the subfigure onto a new line)
	\begin{subfigure}[b]{0.31\textwidth}
%		\includegraphics[width=\textwidth]{mouse}
		\caption{A mouse}
		\label{fig:mouse}
	\end{subfigure}
	\caption{Pictures of animals}\label{fig:fitting}
\end{figure}


\section{Euler-Lagrange equation for the ACWE model}
To be clear, minimizing $\eacwe$ is very hard as there is $\C$ (or equivalently $\Sigma$), $c_1$, and $c_2$ to consider. Rather than simultaneous minimization wrt $\C$, $c_1$, and $c_2$, we will follow the clever alternating minimization scheme suggested in \cite{chan2001active}. The procedure will be to optimize first wrt $c_1$ and $c_2$ with $\C$ fixed, then with $c_1$ and $c_2$ determined, minimize wrt $\C$.

Fixing $\C$, it is then elementary calculus to determine $c_1$ and $c_2$: 
\begin{align}
0 = \pd{\eacwe}{c_1}  = 2\lambda \int_{\Sigma} (c_1 - f ) \dx
&\implies 
c_1 = \frac{1}{\abs{\Sigma}} \int_{\Sigma} f \dx,
\label{eq:c1}
\\
0 = \pd{\eacwe}{c_2}  = 2\lambda \int_{\Omega\setminus \Sigma} (c_2 - f )\dx
&\implies 
c_2 = \frac{1}{\abs{\Omega\setminus\Sigma}} \int_{\Omega\setminus \Sigma} f \dx,
\label{eq:c2}
\end{align}
where we used $\abs{\cdot}$ to denote the area of a set. Next to derive the Euler-Lagrange equation to $\eacwe$, we must first rewrite it in terms of a level set function to move the dependence of the fitting terms on $\Sigma$ directly into the integrand. The three terms forming $\eacwe$ can be expressed as 
\begin{align}
\textrm{Length}(\C) 
= \textrm{Perimeter}(\Sigma) 
&= \int_{\Omega} \abs{\nabla \mathbf{1}_\Sigma(x)} \dx
= \int_{\Omega} \abs{ \nabla H(\phi(x)) } \dx,
\label{eacwe1}
\\
\int_{\Sigma} (c_1 - f(x) )^2 \, d\Omega 
&= \int_{\Omega} (c_1 - f(x))^2 H(\phi(x)) \, d\Omega
\\
\int_{\Omega\setminus\Sigma} (c_2 - f(x))^2 \dx 
&=
\int_{\Omega} (c_2 - f(x))^2 (1 - H(\phi(x))) \dx
\end{align}
The trouble with differentiating the Heaviside function is handled by subsituting with a regularized version: $H_\varepsilon \in C^2$, and $H_\varepsilon \rightarrow H$ as $\varepsilon\rightarrow 0$ and denote $\delta_\varepsilon = H'_\varepsilon$. The regularized energy (which we will continue to call $\eacwe$ for convenience) is then 
\begin{align*}
\eacwe(\phi) 
&= \int_{\Omega } \abs{\nabla H_\varepsilon(\phi(x))} \dx 
+ \lambda\int_{\Omega} (c_1 - f(x))^2 H_\varepsilon(\phi(x)) \, d\Omega 
+ \lambda\int_{\Omega} (c_2 - f(x))^2 (1 - H_\varepsilon(\phi(x))) \dx
\\
&= \int_{\Omega } \delta_\varepsilon(\phi(x)) \abs{\nabla \phi(x)} \dx 
+ \lambda\int_{\Omega} (c_1 - f(x))^2 H_\varepsilon(\phi(x)) \, d\Omega 
+ \lambda\int_{\Omega} (c_2 - f(x))^2 (1 - H_\varepsilon(\phi(x))) \dx,
\end{align*}
and its first variation
\begin{align*}
\dd{}{\gamma}\eacwe(\phi + \gamma h) \bigg\rvert_{\gamma = 0}
&= \int_{\Omega} \delta'_\varepsilon(\phi) \abs{\nabla \phi} h + \delta_\varepsilon(\phi) \frac{\nabla \phi}{\abs{\nabla \phi}} \cdot \nabla h \dx
+ \lambda\int_{\Omega} \underbrace{\left[(c_1 - f)^2 - (c_2 - f)^2 \right]}_{=r(x)} \delta_\varepsilon(\phi) h \dx 
\\
&= \int_{\Omega } \delta'_\varepsilon \abs{\nabla \phi} h
- \Div\left(\delta_\varepsilon\frac{\nabla \phi}{\abs{\nabla \phi}}  \right)  h
\dx 
+ \int_\Gamma h\delta_\varepsilon\frac{\nabla \phi}{\abs{\nabla \phi}} \cdot \normal \,d\Gamma 
+ \lambda\int_{\Omega} r \delta_\varepsilon h \dx
\\
&= \int_{\Omega} \delta_\varepsilon\left[ 
- \Div\left(\frac{\nabla \phi}{\abs{\nabla \phi}} \right) + \lambda r
\right] h\dx 
+ \int_\Gamma h\delta_\varepsilon\frac{\nabla \phi}{\abs{\nabla \phi}} \cdot \normal \,d\Gamma. 
\end{align*}
The gradient descent evolution is thus 
\begin{align}
\phi_t 
= \delta_\epsilon(\phi) \left[ 
\Div\left(\frac{\nabla \phi}{\abs{\nabla \phi}} \right) - \lambda (c_1 - f)^2 + \lambda (c_2 - f)^2 
\right]
\label{eq:acwe_el}
\end{align}
with boundary condition $\delta_\varepsilon 
\frac{\nabla \phi}{\abs{\nabla \phi}} \cdot \normal = 0$.





